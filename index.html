<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>note.me ‚Äì Online Book Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Quill -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<style>
body{margin:0;font-family:sans-serif;height:100vh;display:flex;flex-direction:column}
header{background:#1e40af;color:#fff;padding:8px;display:flex;align-items:center}
header input{margin-left:10px;padding:5px;font-size:16px;width:100%}
main{flex:1;display:flex}
#left{width:260px;background:#f1f5f9;padding:10px;overflow-y:auto}
#editorWrap{flex:1;display:flex;flex-direction:column}
.toolbar{padding:6px;border-bottom:1px solid #ccc;background:#fafafa}
button{margin:2px}
.chapter{background:#fff;padding:6px;margin-bottom:4px;border-radius:4px;cursor:pointer}
.chapter.active{background:#dbeafe}
footer{text-align:center;font-size:12px;padding:4px;background:#e5e7eb}

/* Image tools */
.img-toolbar{
  position:fixed;bottom:10px;right:10px;
  background:#fff;border:1px solid #ccc;
  padding:6px;display:none;z-index:9999
}
</style>
</head>

<body>

<header>
  üìò <input id="bookTitle" placeholder="‡§¨‡•Å‡§ï‡§ï‡•ã ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï">
</header>

<main>
  <div id="left">
    <button onclick="addChapter()">+ ‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø</button>
    <div id="chapters"></div>
  </div>

  <div id="editorWrap">
    <div class="toolbar">
      <button onclick="addTopic()">‚ûï ‡§µ‡§ø‡§∑‡§Ø</button>
      <button onclick="addPara()">‚ûï ‡§™‡§∞‡§ø‡§ö‡•ç‡§õ‡•á‡§¶</button>
      <button onclick="addTable()">‚ûï ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ</button>
      <button onclick="exportPDF()">üìÑ PDF</button>
      <button onclick="openReader()">üìñ Read</button>
    </div>
    <div id="editor" style="flex:1"></div>
  </div>
</main>

<footer>‚úî Auto-saved</footer>

<!-- Image tools -->
<div class="img-toolbar" id="imgTools">
  <button onclick="imgAlign('left')">‚¨ÖÔ∏è</button>
  <button onclick="imgAlign('center')">‚¨ú</button>
  <button onclick="imgAlign('right')">‚û°Ô∏è</button>
  <button onclick="imgResize(50)">50%</button>
  <button onclick="imgResize(100)">100%</button>
</div>

<!-- Libraries -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
/* ---------- BOOK STORAGE ---------- */
let book = JSON.parse(localStorage.getItem('book')) || {
  title:'', chapters:[], current:null
};

document.getElementById('bookTitle').value = book.title;
document.getElementById('bookTitle').oninput = e=>{
  book.title=e.target.value; save();
};

function save(){
  localStorage.setItem('book',JSON.stringify(book));
}

/* ---------- QUILL ---------- */
const q = new Quill('#editor',{
  theme:'snow',
  modules:{ toolbar:[
    [{header:[1,2,3,false]}],
    ['bold','italic','underline'],
    [{list:'ordered'},{list:'bullet'}],
    ['image'],
    ['clean']
  ]}
});

/* ---------- CHAPTER ---------- */
function addChapter(){
  const t=prompt("‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï");
  if(!t)return;
  const c={id:Date.now(),title:t,content:''};
  book.chapters.push(c); book.current=c.id;
  save(); render(); load(c.id);
}

function render(){
  const box=document.getElementById('chapters');
  box.innerHTML='';
  book.chapters.forEach(c=>{
    const d=document.createElement('div');
    d.className='chapter'+(c.id===book.current?' active':'');
    d.innerText=c.title;
    d.onclick=()=>load(c.id);
    box.appendChild(d);
  });
}

function load(id){
  const c=book.chapters.find(x=>x.id===id);
  if(!c)return;
  book.current=id;
  q.root.innerHTML=c.content;
  render();
}

q.on('text-change',()=>{
  const c=book.chapters.find(x=>x.id===book.current);
  if(!c)return;
  c.content=q.root.innerHTML; save();
});

/* ---------- ‡§µ‡§ø‡§∑‡§Ø / ‡§™‡§∞‡§ø‡§ö‡•ç‡§õ‡•á‡§¶ ---------- */
function addTopic(){
  const r=q.getSelection(true);
  q.insertText(r.index,"‡§µ‡§ø‡§∑‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï\n",{header:2});
}
function addPara(){
  const r=q.getSelection(true);
  q.insertText(r.index,"\n‡§™‡§∞‡§ø‡§ö‡•ç‡§õ‡•á‡§¶ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç...\n");
}

/* ---------- TABLE ---------- */
let activeTable=null;
document.addEventListener('click',e=>{
  if(e.target.closest('table')) activeTable=e.target.closest('table');
});
function addTable(){
  const r=q.getSelection(true);
  q.clipboard.dangerouslyPasteHTML(r.index,
    `<table border="1" style="width:100%;border-collapse:collapse">
      <tr><th>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡•ß</th><th>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡•®</th></tr>
      <tr><td>‡§°‡§æ‡§ü‡§æ</td><td>‡§°‡§æ‡§ü‡§æ</td></tr>
    </table><p><br></p>`);
}

/* ---------- IMAGE TOOLS ---------- */
let selectedImg=null;
document.addEventListener('click',e=>{
  if(e.target.tagName==='IMG'){
    selectedImg=e.target;
    imgTools.style.display='block';
  }else imgTools.style.display='none';
});
function imgAlign(p){
  if(!selectedImg)return;
  selectedImg.style.display='block';
  selectedImg.style.margin=p==='center'?'auto':(p==='left'?'0 auto 0 0':'0 0 0 auto');
}
function imgResize(p){
  if(selectedImg) selectedImg.style.width=p+'%';
}

/* ---------- PDF ---------- */
function exportPDF(){
  html2pdf().from(document.getElementById('editor')).save(book.title||'book.pdf');
}

/* ---------- READER ---------- */
function openReader(){
  window.open('reader.html','_blank');
}

/* INIT */
render();
if(book.current) load(book.current);
</script>

</body>
</html>
