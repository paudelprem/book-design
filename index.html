<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>note.me ‚Äì Book Layout Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<style>
@font-face{
  font-family:Kalimati;
  src:url('https://raw.githubusercontent.com/sajandhakal/Kalimati-Font/master/Kalimati.ttf');
}

body{
  margin:0;
  font-family:Kalimati, serif;
  background:#e5e7eb;
}

/* UI */
header{
  background:#1e40af;
  color:#fff;
  padding:8px;
}
header input{
  width:100%;
  font-size:18px;
  padding:6px;
  font-family:Kalimati, serif;
}
.toolbar{
  background:#fafafa;
  padding:6px;
  border-bottom:1px solid #ccc;
}
.toolbar button{margin:2px}

/* Book layout */
.book{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  padding:20px;
}
.page{
  width:210mm;
  min-height:297mm;
  background:#fff;
  box-shadow:0 0 10px rgba(0,0,0,.2);
  padding:25mm 20mm;
  box-sizing:border-box;
  position:relative;
}
.page.left{border-right:2px solid #ddd}
.page.right{border-left:2px solid #ddd}

/* Header / Footer */
.page-header{
  position:absolute;
  top:10mm;
  left:0; right:0;
  text-align:center;
  font-size:13px;
  color:#444;
}
.page-footer{
  position:absolute;
  bottom:10mm;
  left:0; right:0;
  text-align:center;
  font-size:12px;
  color:#555;
}

/* Page number */
body{counter-reset:page}
.page{counter-increment:page}
.page-footer::after{content:counter(page)}

/* Editor text */
.ql-editor{
  font-family:Kalimati, serif;
  font-size:18px;
  line-height:1.9;
}
.ql-editor p{text-align:justify}

/* Table */
table{border-collapse:collapse;width:100%}
td,th{border:1px solid #000;padding:4px;position:relative}
.table-borderless td,.table-borderless th{border:none}
.table-zebra tr:nth-child(even){background:#f8fafc}

/* Print */
@media print{
  header,.toolbar{display:none}
  .book{display:block}
  .page{
    box-shadow:none;
    margin:0;
    page-break-after:always;
  }
}
</style>
</head>

<body>

<header>
  <input id="bookTitle" placeholder="‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï">
</header>

<div class="toolbar">
  <button onclick="addTopic()">‚ûï ‡§µ‡§ø‡§∑‡§Ø</button>
  <button onclick="addPara()">‚ûï ‡§™‡§∞‡§ø‡§ö‡•ç‡§õ‡•á‡§¶</button>
  <button onclick="addTable()">‚ûï Table</button>

  <button onclick="addRow()">‚ûï Row</button>
  <button onclick="addCol()">‚ûï Col</button>
  <button onclick="delRow()">‚ûñ Row</button>
  <button onclick="delCol()">‚ûñ Col</button>

  <button onclick="hl('yellow')">üü®</button>
  <button onclick="hl('lightgreen')">üü©</button>
  <button onclick="fc('red')">üî¥</button>
  <button onclick="fc('blue')">üîµ</button>

  <button onclick="exportPDF()">üìÑ PDF</button>
</div>

<div id="editor">
  <div class="book">
    <div class="page left">
      <div class="page-header book-title"></div>
      <div class="page-body"></div>
      <div class="page-footer"></div>
    </div>
    <div class="page right">
      <div class="page-header book-title"></div>
      <div class="page-body"></div>
      <div class="page-footer"></div>
    </div>
  </div>
</div>

<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
/* ---------- BOOK ---------- */
let book={title:''};
const titleInput=document.getElementById('bookTitle');
titleInput.oninput=e=>{
  book.title=e.target.value;
  document.querySelectorAll('.book-title')
    .forEach(h=>h.innerText=book.title);
};

/* ---------- QUILL ---------- */
const q=new Quill('.page-body',{
  theme:'snow',
  modules:{
    toolbar:[
      [{header:[1,2,3,false]}],
      ['bold','italic','underline'],
      [{color:[]},{background:[]}],
      [{list:'ordered'},{list:'bullet'}],
      ['clean']
    ]
  }
});

/* ---------- ACTIVE TABLE FIX (IMPORTANT) ---------- */
let activeCell=null;
let activeTable=null;

q.root.addEventListener('click',e=>{
  const cell=e.target.closest('td,th');
  if(cell){
    activeCell=cell;
    activeTable=cell.closest('table');
  }
});

/* ---------- CONTENT ---------- */
function addTopic(){
  q.clipboard.dangerouslyPasteHTML(
    q.getSelection(true).index,
    `<h2>‡§µ‡§ø‡§∑‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</h2><p><br></p>`
  );
}
function addPara(){
  q.insertText(q.getSelection(true).index,'‡§™‡§∞‡§ø‡§ö‡•ç‡§õ‡•á‡§¶ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç...\n');
}

/* ---------- FONT ---------- */
function hl(c){const r=q.getSelection(); if(r) q.format('background',c);}
function fc(c){const r=q.getSelection(); if(r) q.format('color',c);}

/* ---------- TABLE ---------- */
function addTable(){
  const r=parseInt(prompt("Row?"));
  const c=parseInt(prompt("Column?"));
  if(!r||!c) return;

  let h='<table>';
  for(let i=0;i<r;i++){
    h+='<tr>';
    for(let j=0;j<c;j++) h+='<td></td>';
    h+='</tr>';
  }
  h+='</table><p><br></p>';

  q.clipboard.dangerouslyPasteHTML(q.getSelection(true).index,h);
}

function addRow(){
  if(!activeCell) return alert("‡§™‡§π‡§ø‡§≤‡§æ table cell ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  const row=activeCell.parentElement;
  const cols=row.cells.length;
  const nr=activeTable.insertRow(row.rowIndex+1);
  for(let i=0;i<cols;i++) nr.insertCell();
}
function addCol(){
  if(!activeCell) return alert("‡§™‡§π‡§ø‡§≤‡§æ table cell ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  const ci=activeCell.cellIndex+1;
  [...activeTable.rows].forEach(r=>r.insertCell(ci));
}
function delRow(){
  if(activeCell) activeTable.deleteRow(activeCell.parentElement.rowIndex);
}
function delCol(){
  if(!activeCell) return;
  const ci=activeCell.cellIndex;
  [...activeTable.rows].forEach(r=>r.deleteCell(ci));
}

/* ---------- PDF ---------- */
function exportPDF(){
  html2pdf().from(document.getElementById('editor'))
    .save((book.title||'book')+'.pdf');
}
</script>

</body>
</html>

